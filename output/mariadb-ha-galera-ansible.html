<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="/theme/pygments/default.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/font-awesome.min.css">




    <link rel="shortcut icon" href="images/favicon.jpg" type="image/x-icon">
    <link rel="icon" href="images/favicon.jpg" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#111111">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#111111">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="author" content="Arun prasath" />
<meta name="description" content="This is a write up explaining setting up a MariaDB cluster using Ansible in Ubuntu 12.04 / Ubuntu 14.04." />
<meta name="keywords" content="Ansible, Automation, Database, High availability">
<meta property="og:site_name" content="Arun's blog"/>
<meta property="og:title" content="Deploy a MariaDB high available cluster using Ansible"/>
<meta property="og:description" content="This is a write up explaining setting up a MariaDB cluster using Ansible in Ubuntu 12.04 / Ubuntu 14.04."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/mariadb-ha-galera-ansible.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-05-05 11:22:00+05:30"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/arun-prasath.html">
<meta property="article:section" content="Openstack"/>
<meta property="article:tag" content="Ansible"/>
<meta property="article:tag" content="Automation"/>
<meta property="article:tag" content="Database"/>
<meta property="article:tag" content="High availability"/>
<meta property="og:image" content="https://avatars2.githubusercontent.com/u/5082801?v=3&s=460">
  <title>Arun's blog &ndash; Deploy a MariaDB high available cluster using Ansible</title>
</head>
<body>
  <aside>
    <div>
      <a href="">
        <img src="https://avatars2.githubusercontent.com/u/5082801?v=3&s=460" alt="Arun prasath" title="Arun prasath">
      </a>
      <h1><a href="">Arun prasath</a></h1>
<p>Cloud engineer in Wanclouds Inc @ Cisco</p>      <nav>
        <ul class="list">
          <li><a href="/pages/my-super-post.html#my-super-post">About me</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-linkedin" href="http://www.linkedin.com/in/bingoarunprasath" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="https://github.com/bingoarunprasath" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-facebook" href="https://www.facebook.com/bingoarunprasath" target="_blank"><i class="fa fa-facebook"></i></a></li>
        <li><a class="sc-envelope-o" href="test" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
    </nav>

<article>
  <header>
    <h1 id="mariadb-ha-galera-ansible">Deploy a MariaDB high available cluster using Ansible</h1>
    <p>Posted on Thu 05 May 2016 in <a href="/category/openstack.html">Openstack</a></p>
  </header>
  <div>
    <h1>Requirements</h1>
<p>Ansible version 1.9.2 (Not tested in other versions yet)</p>
<p>n number of target machines (Ubuntu 12.04 / Ubuntu 14.04) for deploying MariaDB cluster</p>
<p>Here I am using 5 Ubuntu 14.04 VMs in an Openstack environment.</p>
<h1>Deploying MariaDB</h1>
<p>From the build server clone the repository.</p>
<div class="highlight"><pre><span></span># git clone https://github.com/bingoarunprasath/ansible-mariadb-galera-web.git
# cd ansible-mariadb-galera-web
</pre></div>


<p>Edit the inventory to include the server details and set the password.</p>
<div class="highlight"><pre><span></span># cat inventory 
[database]
192.168.1.48 ansible_ssh_user=cloud-user
192.168.1.49 ansible_ssh_user=cloud-user
192.168.1.50 ansible_ssh_user=cloud-user
192.168.1.51 ansible_ssh_user=cloud-user
192.168.1.52 ansible_ssh_user=cloud-user

[database:vars]
root_password=TomAndJerry
debian_sys_maint_password=TomAndJerry
</pre></div>


<p>Ensure that you are able to ping the VMs.</p>
<div class="highlight"><pre><span></span># ansible database -m ping -i inventory 
192.168.1.48 | success &gt;&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}

192.168.1.49 | success &gt;&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}

192.168.1.50 | success &gt;&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}

192.168.1.52 | success &gt;&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}

192.168.1.51 | success &gt;&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
</pre></div>


<p>Now run the site.yml as below</p>
<div class="highlight"><pre><span></span># ansible-playbook site.yml -i inventory -become

PLAY [database] *************************************************************** 

GATHERING FACTS *************************************************************** 
ok: [192.168.1.52]
ok: [192.168.1.51]
ok: [192.168.1.48]
ok: [192.168.1.49]

&lt;TRUNCATED&gt;

TASK: [mariadb | Restart mysql on first node] ********************************* 
skipping: [192.168.1.49]
skipping: [192.168.1.50]
skipping: [192.168.1.51]
skipping: [192.168.1.52]
changed: [192.168.1.48]

PLAY RECAP ******************************************************************** 
192.168.1.48               : ok=19   changed=13   unreachable=0    failed=0   
192.168.1.49               : ok=18   changed=12   unreachable=0    failed=0   
192.168.1.50               : ok=18   changed=12   unreachable=0    failed=0   
192.168.1.51               : ok=18   changed=12   unreachable=0    failed=0   
192.168.1.52               : ok=18   changed=12   unreachable=0    failed=0 
</pre></div>


<p>This should get the MariaDB cluster up and running in master-master mode.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/ansible.html">Ansible</a>
      <a href="/tag/automation.html">Automation</a>
      <a href="/tag/database.html">Database</a>
      <a href="/tag/high-availability.html">High availability</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'bingoarunprasath';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <footer>
        <p>&copy; Arun prasath 2016</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78404732-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Arun's blog ",
  "url" : "",
  "image": "https://avatars2.githubusercontent.com/u/5082801?v=3&s=460",
  "description": ""
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Deploy a MariaDB high available cluster using Ansible",
  "headline": "Deploy a MariaDB high available cluster using Ansible",
  "datePublished": "2016-05-05 11:22:00+05:30",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Arun prasath",
    "url": "/author/arun-prasath.html"
  },
  "image": "https://avatars2.githubusercontent.com/u/5082801?v=3&s=460",
  "url": "/mariadb-ha-galera-ansible.html",
  "description": "This is a write up explaining setting up a MariaDB cluster using Ansible in Ubuntu 12.04 / Ubuntu 14.04."
}
</script></body>
</html>